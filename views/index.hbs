{{#if currentActivity}}
  <div class="current-activity-card">
    <h2>ðŸŽ¯ Current Activity</h2>
    <h3>{{currentActivity.activity}}</h3>
    <p class="time">{{currentActivity.startTime}} - {{currentActivity.endTime}}</p>

    {{#if activeSession}}
      <div class="session-form">
        <h4>Session in Progress</h4>
        <p>Started at: {{activeSession.actualStartTime}}</p>
        <form method="POST" action="/timetable/sessions/{{activeSession.id}}/complete">
          <textarea name="learnings" placeholder="What did you learn?" required></textarea>
          <textarea name="notes" placeholder="Additional notes (optional)"></textarea>
          <button type="submit" class="btn btn-success">Complete Session</button>
        </form>
      </div>
    {{else}}
      <form method="POST" action="/timetable/sessions/start/{{currentActivity.id}}" style="margin-top:15px;">
        <button type="submit" class="btn btn-success">Start Session</button>
      </form>
    {{/if}}
  </div>
{{/if}}

<div class="card">
  <h3>Today's Completed Sessions</h3>
  {{#each todaysSessions}}
    {{#if this.completed}}
      <div class="session-card">
        <strong>{{this.activity.activity}}</strong>
        <p class="time">{{this.actualStartTime}} - {{this.actualEndTime}}</p>
        {{#if this.learnings}}<p><em>Learnings: {{this.learnings}}</em></p>{{/if}}
      </div>
    {{/if}}
  {{/each}}
</div>

<div class="card">
  <h2>Add New Activity</h2>
  <form method="POST" action="/timetable/activities">
    <div class="grid">
      <div>
        <label>Day</label>
        <select name="day" required>
          {{#each days}}
            <option value="{{this}}">{{this}}</option>
          {{/each}}
        </select>
      </div>
      <div>
        <label>Start Time</label>
        <input type="time" name="startTime" required>
      </div>
      <div>
        <label>End Time</label>
        <input type="time" name="endTime" required>
      </div>
    </div>
    <div style="margin-top:15px;">
      <label>Activity</label>
      <input type="text" name="activity" placeholder="What will you be doing?" required>
    </div>
    <button type="submit" class="btn btn-primary" style="margin-top:15px;">Add Activity</button>
  </form>
</div>

<h2>Weekly Timetable</h2>
<table>
  <thead>
  <tr>
    <th>Day</th>
    <th>Activities</th>
  </tr>
  </thead>
  <tbody>
  {{#each days}}
    <tr>
      <td><strong>{{this}}</strong></td>
      <td>
        <div class="activities-container">
          {{#with (lookup ../timetable this)}}
            {{#each this}}
              <div class="activity-card">
                <strong>{{this.activity}}</strong>
                <p class="time">{{this.startTime}} - {{this.endTime}}</p>
              </div>
            {{/each}}
          {{else}}
            <p class="no-activity">No activities</p>
          {{/with}}
        </div>
      </td>
    </tr>
  {{/each}}
  </tbody>
</table>
